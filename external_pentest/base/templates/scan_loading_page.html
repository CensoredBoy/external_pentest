{% extends 'base.html' %}
    {% block content %}
        <h2> <a href="{%url 'main'%}">Back</a></h2>
        <div class="loader"></div>
        <h1 id="message"></h1>
        <script>
            let scanId = document.URL.split("/");
            scanId = scanId[scanId.length-2];
            const chatSocket = new WebSocket(
                'ws://'
                + window.location.host
                + '/ws/scan/'
                + scanId
                + '/'
            );

            chatSocket.onmessage = function(e) {
                const data = JSON.parse(e.data);
                console.log(data);
                if(data["status"] == "DONE"){
                    location.reload();
                }else if(data["status"] == "ERROR"){
                    let message_field = document.getElementById("message");
                    message_field.innerText = data["message"];
                }
            };

            chatSocket.onclose = function(e) {
                console.error('Chat socket closed unexpectedly');
            };
        </script>
    {% endblock %}