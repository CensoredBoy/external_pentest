from django.shortcuts import render, redirect
from django.http import HttpResponse
from django.contrib.auth import authenticate, login, logout
from django.contrib.auth.decorators import login_required
from .forms import DomainForm
from .models import Scan, IP, Domain



@login_required
def main(request):
    if request.method == 'POST':
        form = DomainForm(request.POST)
        if form.is_valid():
            scan = Scan(user=request.user, name=form.cleaned_data['name'], main_domain=form.cleaned_data['domain'])
            scan.save()
    else:
        form = DomainForm()
    scans = Scan.objects.filter(user = request.user)
    context = {
        'form':form,
        'scans':scans
    }
    return render(request, 'main.html', context)

@login_required
def scan(request, scan_id):
    scan = Scan.objects.get(pk=scan_id)
    context = {
        'scan':scan
    }
    return render(request, 'scan.html', context)